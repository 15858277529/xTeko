<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<style>
			* {
				margin: 0px;
				padding: 0px;
			}
		</style>
		<script src="./js/jsnes.js"></script>
		<script src="./js/ringbuffer.js"></script>
		<script src="./js/embed.js"></script>
		<script>
			function initGame(url) {
				this.url = url;
			}

			function loadGame() {
				document.getElementById("container").style.display = "block";
				document.getElementById("player").style.display = "none";
				nes_load_url("canvas", this.url);
				this.started = true;
			}

			function keyDown(id) {
				nes_keydown(id);
			}

			function keyUp(id) {
				nes_keyup(id);
			}

			function resetKeys() {
				nes_reset_keys();
			}

			function dumpState() {
				if (!this.started) {
					return null;
				}

				let state = nes_dump_state();
				let image = document.getElementById("canvas").toDataURL("image/jpeg", 0.8);
				return {
					"data": state,
					"image": image
				};
			}

			function loadState(path) {
				if (!this.started) {
					return;
				}
				
				fetch(`./states/${path}`)
				.then(response => response.json())
				.then(state => nes_set_state(state));
			}
		</script>
	</head>
	<body style="-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;" unselectable="on" onselectstart="return false;" onmousedown="return false;">
		<div id="player" style="width: 100%; height: 100vh; background: black; display: block; text-align: center;">
			<img src="./img/btn.png" style="position: absolute; top: 50%; left: 50%; margin-top: -90px; margin-left: -90px;" onclick="loadGame()">
		</div>
		<div id="container" style="display: none">
			<canvas id="canvas" width="256" height="240" style="width: 100%">
		</div>
	</body>
</html>